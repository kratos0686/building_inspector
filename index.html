<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Building Inspectors Tool</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/favicon.ico" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root { --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#0ea5e9; }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    header{position:sticky; top:0; z-index:50; padding:14px 18px; background:linear-gradient(135deg,#0ea5e9 0%,#22c55e 100%); color:#04131a; display:flex; align-items:center; gap:12px}
    header img{height:28px;width:28px}
    main{padding:18px; max-width:1200px; margin:0 auto}
    .panel{background:#111827; border:1px solid #334155; border-radius:12px; padding:12px; margin-bottom:14px}
    h2{margin:0 0 10px 0; font-size:20px}
    .muted{color:var(--muted); font-size:13px}
    label{font-weight:600}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    input[type="checkbox"]{transform:scale(1.2)}
    .btn{border:none; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:600}
    .btn-primary{background:#0ea5e9; color:#04131a}
    .btn-secondary{background:#3f3f46; color:#e5e7eb}
    .btn-warn{background:#ef4444; color:#240505}
  </style>
</head>
<body>
<header>
  <img src="assets/logo.png" alt="Logo"/>
  <h1>Building Inspectors Tool</h1>
</header>
<main>
  <div class="panel">
    <h2>Update Settings</h2>
    <div class="row">
      <label for="installOnQuitToggle">Install updates on app quit</label>
      <input id="installOnQuitToggle" type="checkbox" />
      <span class="muted" id="installOnQuitStatus">Loadingâ€¦</span>
    </div>
    <hr/>
    <div class="row">
      <label for="testerModeToggle">Tester Mode (beta channel)</label>
      <input id="testerModeToggle" type="checkbox" />
      <span class="muted" id="testerModeStatus">Loadingâ€¦</span>
    </div>
    <div class="row" style="margin-top:8px;">
      <button class="btn btn-secondary" id="applyLaterBtn">ðŸ’¾ Save (Restart Later)</button>
      <button class="btn btn-primary"   id="switchNowBtn">âš¡ Apply & Restart Now</button>
      <button class="btn btn-warn"      id="switchNowConfirmBtn">âœ… Apply & Restart (Confirm)</button>
    </div>
  </div>

  <div class="panel">
    <h2>Quick Actions</h2>
    <div class="row">
      <button class="btn btn-secondary" id="checkBtn">Help â†’ Check for Updatesâ€¦</button>
      <button class="btn btn-primary" id="notesBtn">Help â†’ View Release Notes</button>
    </div>
    <p class="muted">These mirror desktop menu actions when running under Electron.</p>
  </div>

  <div class="panel">
    <h2>App Status</h2>
    <div id="statusBox" class="muted">Ready.</div>
  </div>
</main>
<script>
(function(){
  const hasElectron = typeof window.electronAPI !== 'undefined';
  const installToggle = document.getElementById('installOnQuitToggle');
  const installStatus = document.getElementById('installOnQuitStatus');
  const testerToggle = document.getElementById('testerModeToggle');
  const testerStatus = document.getElementById('testerModeStatus');
  const applyLaterBtn = document.getElementById('applyLaterBtn');
  const switchNowBtn = document.getElementById('switchNowBtn');
  const switchNowConfirmBtn = document.getElementById('switchNowConfirmBtn');

  async function init(){
    if (!hasElectron) {
      for (const el of [installToggle, testerToggle, applyLaterBtn, switchNowBtn, switchNowConfirmBtn]) { el.disabled = true; }
      installStatus.textContent = 'Not available in browser mode';
      testerStatus.textContent = 'Not available in browser mode';
      return;
    }
    try{ const enabled = await window.electronAPI.getAutoInstallOnQuit(); installToggle.checked = !!enabled; installStatus.textContent = enabled ? 'Enabled' : 'Disabled'; }catch{}
    try{ const tmode = await window.electronAPI.getTesterMode(); testerToggle.checked = !!tmode; testerStatus.textContent = tmode ? 'Beta channel' : 'Stable channel'; }catch{}
  }

  installToggle.addEventListener('change', async () => {
    if (!hasElectron) return;
    const enabled = !!installToggle.checked;
    await window.electronAPI.setAutoInstallOnQuit(enabled);
    installStatus.textContent = enabled ? 'Enabled' : 'Disabled';
  });

  applyLaterBtn.addEventListener('click', async () => {
    if (!hasElectron) return;
    const enabled = !!testerToggle.checked;
    await window.electronAPI.setTesterMode(enabled);
  });

  switchNowBtn.addEventListener('click', async () => {
    if (!hasElectron) return;
    const enabled = !!testerToggle.checked;
    await window.electronAPI.switchTesterModeNow(enabled);
  });

  switchNowConfirmBtn.addEventListener('click', async () => {
    if (!hasElectron) return;
    const enabled = !!testerToggle.checked;
    await window.electronAPI.switchTesterModeNowConfirm(enabled);
  });

  document.getElementById('checkBtn').addEventListener('click', () => {
    alert('Use Help â†’ Check for Updatesâ€¦ from the desktop app menu.');
  });
  document.getElementById('notesBtn').addEventListener('click', () => {
    window.open('https://github.com/kratos0686/building-inspectors-releases/releases/latest','_blank');
  });

  init();
})();
</script>
</body>
</html>
